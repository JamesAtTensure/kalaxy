---
- name: uninstall kubelet defaults
  file:
    path: /etc/default/kubelet
    state: absent
- name: unhold k8s updates
  dpkg_selections:
    name: "{{ item }}"
    selection: deinstall
  with_items:
    - kubeadm
    - kubectl
    - kubelet
    - kubernetes-cni
- name: uninstall k8s
  apt:
    force_apt_get: yes
    name:
      - kubeadm
      - kubectl
      - kubelet
      - kubernetes-cni
    state: absent
- name: uninstall docker daemon configuration
  file:
    path: /etc/docker/daemon.json
    state: absent
  notify: restart docker
- meta: flush_handlers
