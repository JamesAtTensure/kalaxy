---
- name: set /boot/cmdline.txt
  copy:
    content: "dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory\n"
    dest: /boot/cmdline.txt
  notify: reboot system
- name: set video memory to 16mb
  lineinfile:
    insertafter: '^\s*\[\s*all\s*\]'
    line: "gpu_mem=16"
    path: /boot/config.txt
    regexp: '^\s*#?\s*gpu_mem\s*=\s*'
  notify: reboot system
- name: program usb boot mode
  lineinfile:
    insertafter: '^\s*\[\s*all\s*\]'
    line: "program_usb_boot_mode=1"
    path: /boot/config.txt
    regexp: '^\s*#?\s*program_usb_boot_mode\s*=\s*'
  notify: reboot system
- name: fix overscanning
  lineinfile:
    insertafter: '^\s*\[\s*all\s*\]'
    line: "#disable_overscan=1"
    path: /boot/config.txt
    regexp: '^\s*#?\s*disable_overscan\s*=\s*'
  notify: reboot system
- name: set hostname
  hostname:
    name: "{{ inventory_hostname }}"
  notify: update avahi-daemon
- name: edit /etc/hosts
  lineinfile:
    line: "{{ ansible_default_ipv4.address }}\t{{ inventory_hostname }}"
    path: /etc/hosts
    regexp: '^{{ ansible_default_ipv4.address }}\s+'
- name: remove macos artifacts from /boot directory
  file:
    path: /boot/.Spotlight-V100
    state: absent
- name: update and upgrade all existing packages
  apt:
    force_apt_get: yes
    only_upgrade: yes
    update_cache: yes
    upgrade: yes
  notify: reboot system
- name: remove obsolete or unused packages
  apt:
    autoclean: yes
    autoremove: yes
    force_apt_get: yes
- meta: flush_handlers
