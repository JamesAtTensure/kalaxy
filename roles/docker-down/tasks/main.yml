---
- name: unhold docker updates
  dpkg_selections:
    name: "{{ item }}"
    selection: deinstall
  with_items:
    - containerd.io
    - docker-ce
    - docker-ce-cli
- name: uninstall docker
  apt:
    force_apt_get: yes
    name:
      - containerd.io
      - docker-ce
      - docker-ce-cli
    state: absent
- name: uninstall docker daemon configuration
  file:
    path: /etc/docker/daemon.json
    state: absent
- name: uninstall docker environment
  file:
    path: /etc/systemd/system/multi-user.target.wants/docker.service
    state: absent
  when: proxy_url != ''
- name: remove docker directory
  file:
    path: /var/lib/docker
    state: absent
